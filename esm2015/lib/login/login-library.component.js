import { Component, EventEmitter, Inject, Output } from '@angular/core';
import { FormControl, Validators } from '@angular/forms';
import { CONFIGLIBRARY } from '../../config-library.interface';
import * as i0 from "@angular/core";
import * as i1 from "@angular/forms";
import * as i2 from "./services/auth.service";
import * as i3 from "./interfaces/token-payload-provider.interface";
import * as i4 from "@angular/material/form-field";
import * as i5 from "@angular/material/icon";
import * as i6 from "@angular/material/button";
import * as i7 from "@angular/common";
import * as i8 from "@angular/material/input";
import * as i9 from "../../config-library.interface";
export class LoginLibraryComponent {
    constructor(configLibrary, fb, authService, tokenPorviderService) {
        this.fb = fb;
        this.authService = authService;
        this.tokenPorviderService = tokenPorviderService;
        this.loginClick = new EventEmitter();
        this.resetClick = new EventEmitter();
        this.isAuthenticated = false;
        this.typeLogin = '';
        this.isAd = false;
        this.tokenAd = '';
        this.redirectUri = '';
        this.typeLogin = configLibrary.loginType;
        this.redirectUri = configLibrary.redirectUri;
    }
    ngOnInit() {
        this.loadForm();
        this.typeLogin = this.authService.loginType;
    }
    loadForm() {
        this.loginForm = this.fb.group({
            userName: new FormControl(null, [Validators.required, Validators.maxLength(50)]),
            password: new FormControl(null, [Validators.required, Validators.maxLength(50)]),
        });
    }
    login() {
        if (this.loginForm.invalid) {
            this.loginClick.emit(false);
        }
        else {
            this.authUser();
        }
    }
    authUser() {
        this.authService.login(this.loginForm.value).subscribe(response => {
            if (response) {
                this.tokenPorviderService.setToken(response);
                this.loginClick.emit(true);
            }
            else {
                this.loginClick.emit(false);
            }
        }, error => {
            console.log(error);
            this.loginClick.emit(false);
        });
    }
    loginAD() {
        window.location.href = `${this.redirectUri}`;
    }
    //Reset Password
    recoveryPassEmit() {
        this.resetClick.emit(true);
    }
}
LoginLibraryComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: LoginLibraryComponent, deps: [{ token: CONFIGLIBRARY }, { token: i1.FormBuilder }, { token: i2.AuthenticationService }, { token: i3.TokenPorviderService }], target: i0.ɵɵFactoryTarget.Component });
LoginLibraryComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "12.2.16", type: LoginLibraryComponent, selector: "lib-security-library-login", outputs: { loginClick: "loginClick", resetClick: "resetClick" }, ngImport: i0, template: "<div class=\"container\">\r\n  <div class=\"row form-content justify-content-start align-items-center\">\r\n    <form [formGroup]=\"loginForm\" >\r\n      <div class=\"col col-xl-4 col-lg-8 col-md-8 col-12\">\r\n        <div class=\"container-fluid\">\r\n          <div *ngIf=\"typeLogin !== 'internal'\" class=\"row\">\r\n            <div class=\"col col-12\">\r\n              <mat-label>Correo\r\n              </mat-label>\r\n              <mat-form-field [style.fontSize.px]=\"12\" appearance=\"outline\">\r\n                <mat-label>ejemplo@corrreo.com\r\n                </mat-label>\r\n                <mat-icon matSuffix>email</mat-icon>\r\n                <input \r\n                  matInput \r\n                  type=\"text\" \r\n                  placeholder=\"ejemplo@corrreo.com\" \r\n                  maxlength=\"50\" \r\n                  formControlName=\"userName\" \r\n                  name=\"userName\" \r\n                  id=\"userName\" \r\n                  required>\r\n                  \r\n                <mat-error *ngIf=\"loginForm.get('userName')?.hasError('required') && loginForm.get('userName')?.touched\">\r\n                  Campo requerido\r\n                </mat-error>\r\n              </mat-form-field>\r\n            </div>\r\n            <div class=\"col col-12\">\r\n              <mat-label>Contrase\u00F1a</mat-label>\r\n              <mat-form-field [style.fontSize.px]=\"12\" appearance=\"outline\">\r\n                <mat-label>contrase\u00F1a</mat-label>\r\n                <mat-icon matSuffix>vpn_key</mat-icon>\r\n                <input \r\n                  matInput \r\n                  type=\"password\" \r\n                  placeholder=\"Contrase\u00F1a\" \r\n                  maxlength=\"50\" \r\n                  formControlName=\"password\" \r\n                  name=\"password\" \r\n                  id=\"passwor\" \r\n                  required>\r\n                <mat-error *ngIf=\"loginForm.get('password')?.hasError('required') && loginForm.get('password')?.touched\">\r\n                  Campo requerido\r\n                </mat-error>\r\n              </mat-form-field>\r\n            </div>\r\n            <div class=\"row recovery-pass\">\r\n              <div class=\"col col-12\">\r\n                <button mat-button class=\"btn_tertiary\" (click)=\"recoveryPassEmit()\">Olvide mi contrase\u00F1a</button>\r\n              </div>\r\n            </div>\r\n            <div class=\"col col-12 text-center\">\r\n              <button class=\"btn_primary\" (click)=\"login()\">Iniciar sesi\u00F3n</button>\r\n            </div> \r\n          </div>\r\n          <div *ngIf=\"typeLogin !== 'external'\" class=\"col col-12 text-center\">\r\n            <button mat-button class=\"btn_tertiary\" (click)=\"loginAD()\">Ingresar con Active Directory</button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </form>   \r\n  </div>\r\n</div>", styles: [".btn_primary{color:#f8f9fb;text-transform:initial;text-align:center;background-color:#214eb7;text-decoration:none;border:0;border-radius:8px;cursor:pointer;letter-spacing:1.5px;width:100%!important;height:40px;padding:10px 8px;font-size:14px;font-weight:400}.btn_primary:hover{background-color:#01818f}.btn_primary:disabled{color:#828282;background-color:#b0b0b0;pointer-events:none}.btn_secondary{color:#01818f;text-transform:initial;text-align:center;background-color:#ecfafc;text-decoration:none;border:1px solid #0095A8;border-radius:8px;cursor:pointer;letter-spacing:1.5px;width:150px!important;height:40px;padding:10px 8px;font-size:14px;font-weight:400}.btn_secondary:hover{background-color:#b2eaf333}.btn_secondary:disabled{color:#b0b0b0;background-color:#e9e9e9;border:1px solid #e9e9e9;pointer-events:none}.btn_tertiary{color:#214eb7}.bg_breadcrumb{background:url(/assets/img/bg_breadcrumb.png) no-repeat;background-color:#005db4;background-size:contain;height:72px;padding-left:30px}.bg_breadcrumb .breadcrumb{color:#fff;margin:0;padding:0;font-style:normal;font-weight:600;letter-spacing:.02em;text-transform:capitalize;vertical-align:middle;line-height:58px}.bg_breadcrumb .breadcrumb span{font-size:18px;color:#bcd}.bg_breadcrumb .breadcrumb span:hover{color:#01818f;text-decoration:none}.bg_breadcrumb .breadcrumb li{list-style:none;float:left;margin:5px}.bg_breadcrumb .breadcrumb li:last-child{margin-right:5px}.bg_breadcrumb .breadcrumb li:after{content:\" > \";color:#fff}.bg_breadcrumb .breadcrumb li:last-child:after{content:\"\"}h1{font-size:34px;font-weight:500}h2{font-size:24px;font-weight:500}h3{font-size:20px;font-weight:500}h4{font-size:18px;font-weight:400}h5{font-style:normal!important;font-weight:500!important;font-size:12px!important;line-height:18px!important;letter-spacing:.15px!important;color:#3f4b6c!important}a{color:#118584}.swal2-styled.swal2-confirm{background-color:#0095a8!important}.swal2-styled.swal2-confirm:focus{box-shadow:none!important}.bg_evidence{background:rgba(249,249,249,.55);border:.5px solid #eceff2;box-sizing:border-box;height:261px;padding-left:25px;margin-left:25px;margin-right:25px}.date_evidence{font-style:normal;font-weight:500;font-size:12px;line-height:18px;text-align:center;letter-spacing:.155002px;color:#7792ac}.rb_evidence{display:flex;flex-direction:column;margin:15px 0;width:150px}.container_evidence{margin:4px,4px;padding:4px;overflow-x:auto;overflow-y:hidden;white-space:nowrap;width:100%}.card_evidence{width:170px;text-align:center}.lbl_evidence{font-style:normal;font-weight:500;font-size:12px;line-height:18px;letter-spacing:.15px;color:#3f4b6c}.mat-form-field-no-padding .mat-form-field-wrapper{margin-top:-.5em}.mobile-label{display:none}.mobile-cantidad>input{width:80%}@media (max-width: 600px){.mobile-label{width:130px;display:inline-block;font-weight:bold}.mat-header-row{display:none}.mat-row{flex-direction:column;align-items:start;text-align:left;padding:8px 24px}.mat-cell:first-of-type{padding:5px 10px!important}.mobile-cantidad{width:150px}}.container .form-content .title{font-family:var(--font-poppins-bold);font-style:normal;font-weight:500;font-size:26px;line-height:39px;text-transform:uppercase;color:#9399b2}.container mat-form-field.mat-form-field{width:100%;font-size:16px;color:#9399b2}.container mat-label{font-family:var(--font-roboto);font-style:normal;font-weight:700;font-size:14px;line-height:14px;letter-spacing:.15px;color:#656d8e}.text-center{display:grid}.recovery-pass{text-align:right}.login_title{font-family:\"Poppins\",\"Roboto\",sans-serif;font-style:normal;font-weight:500;font-size:26px;line-height:39px;text-transform:uppercase;color:#f8f9fb}.login_label{font-family:\"Roboto\",sans-serif;font-style:normal;font-weight:bold;font-size:12px;line-height:14px;letter-spacing:.15px;color:#f8f9fb}input::placeholder{font-family:\"Roboto\",sans-serif;font-style:normal;font-weight:500;font-size:14px;line-height:16px;letter-spacing:.15px;color:#9eb7cc}input:-webkit-autofill,input:-webkit-autofill:hover,input:-webkit-autofill:focus,input:-webkit-autofill:active{-webkit-transition:background-color 5000s;transition:background-color 5000s;-webkit-text-fill-color:#656D8E!important}\n"], components: [{ type: i4.MatFormField, selector: "mat-form-field", inputs: ["color", "floatLabel", "appearance", "hideRequiredMarker", "hintLabel"], exportAs: ["matFormField"] }, { type: i5.MatIcon, selector: "mat-icon", inputs: ["color", "inline", "svgIcon", "fontSet", "fontIcon"], exportAs: ["matIcon"] }, { type: i6.MatButton, selector: "button[mat-button], button[mat-raised-button], button[mat-icon-button],             button[mat-fab], button[mat-mini-fab], button[mat-stroked-button],             button[mat-flat-button]", inputs: ["disabled", "disableRipple", "color"], exportAs: ["matButton"] }], directives: [{ type: i1.ɵNgNoValidate, selector: "form:not([ngNoForm]):not([ngNativeValidate])" }, { type: i1.NgControlStatusGroup, selector: "[formGroupName],[formArrayName],[ngModelGroup],[formGroup],form:not([ngNoForm]),[ngForm]" }, { type: i1.FormGroupDirective, selector: "[formGroup]", inputs: ["formGroup"], outputs: ["ngSubmit"], exportAs: ["ngForm"] }, { type: i7.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { type: i4.MatLabel, selector: "mat-label" }, { type: i4.MatSuffix, selector: "[matSuffix]" }, { type: i8.MatInput, selector: "input[matInput], textarea[matInput], select[matNativeControl],      input[matNativeControl], textarea[matNativeControl]", inputs: ["id", "disabled", "required", "type", "value", "readonly", "placeholder", "errorStateMatcher", "aria-describedby"], exportAs: ["matInput"] }, { type: i1.DefaultValueAccessor, selector: "input:not([type=checkbox])[formControlName],textarea[formControlName],input:not([type=checkbox])[formControl],textarea[formControl],input:not([type=checkbox])[ngModel],textarea[ngModel],[ngDefaultControl]" }, { type: i1.MaxLengthValidator, selector: "[maxlength][formControlName],[maxlength][formControl],[maxlength][ngModel]", inputs: ["maxlength"] }, { type: i1.NgControlStatus, selector: "[formControlName],[ngModel],[formControl]" }, { type: i1.FormControlName, selector: "[formControlName]", inputs: ["disabled", "formControlName", "ngModel"], outputs: ["ngModelChange"] }, { type: i1.RequiredValidator, selector: ":not([type=checkbox])[required][formControlName],:not([type=checkbox])[required][formControl],:not([type=checkbox])[required][ngModel]", inputs: ["required"] }, { type: i4.MatError, selector: "mat-error", inputs: ["id"] }] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.16", ngImport: i0, type: LoginLibraryComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'lib-security-library-login',
                    templateUrl: './login-library.component.html',
                    styleUrls: ['./login-library.component.scss']
                }]
        }], ctorParameters: function () { return [{ type: i9.IConfigLibrary, decorators: [{
                    type: Inject,
                    args: [CONFIGLIBRARY]
                }] }, { type: i1.FormBuilder }, { type: i2.AuthenticationService }, { type: i3.TokenPorviderService }]; }, propDecorators: { loginClick: [{
                type: Output
            }], resetClick: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibG9naW4tbGlicmFyeS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9zZWN1cml0eS1saWJyYXJ5L3NyYy9saWIvbG9naW4vbG9naW4tbGlicmFyeS5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9zZWN1cml0eS1saWJyYXJ5L3NyYy9saWIvbG9naW4vbG9naW4tbGlicmFyeS5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLFlBQVksRUFBRSxNQUFNLEVBQVUsTUFBTSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ2hGLE9BQU8sRUFBZSxXQUFXLEVBQWEsVUFBVSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFJakYsT0FBTyxFQUFFLGFBQWEsRUFBa0IsTUFBTSxnQ0FBZ0MsQ0FBQzs7Ozs7Ozs7Ozs7QUFNL0UsTUFBTSxPQUFPLHFCQUFxQjtJQVcvQixZQUMwQixhQUE2QixFQUM1QyxFQUFlLEVBQ2YsV0FBa0MsRUFDbEMsb0JBQTBDO1FBRjFDLE9BQUUsR0FBRixFQUFFLENBQWE7UUFDZixnQkFBVyxHQUFYLFdBQVcsQ0FBdUI7UUFDbEMseUJBQW9CLEdBQXBCLG9CQUFvQixDQUFzQjtRQWQzQyxlQUFVLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUNoQyxlQUFVLEdBQUcsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUduQyxvQkFBZSxHQUFHLEtBQUssQ0FBQztRQUN4QixjQUFTLEdBQVcsRUFBRSxDQUFDO1FBQzlCLFNBQUksR0FBWSxLQUFLLENBQUM7UUFDdEIsWUFBTyxHQUFXLEVBQUUsQ0FBQztRQUNyQixnQkFBVyxHQUFXLEVBQUUsQ0FBQztRQVF0QixJQUFJLENBQUMsU0FBUyxHQUFHLGFBQWEsQ0FBQyxTQUFTLENBQUM7UUFDekMsSUFBSSxDQUFDLFdBQVcsR0FBRyxhQUFhLENBQUMsV0FBVyxDQUFDO0lBQy9DLENBQUM7SUFFSyxRQUFRO1FBQ1osSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBQ2hCLElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxTQUFTLENBQUM7SUFDL0MsQ0FBQztJQUVPLFFBQVE7UUFDYixJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDO1lBQzVCLFFBQVEsRUFBRSxJQUFJLFdBQVcsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxVQUFVLENBQUMsUUFBUSxFQUFFLFVBQVUsQ0FBQyxTQUFTLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztZQUNoRixRQUFRLEVBQUUsSUFBSSxXQUFXLENBQUMsSUFBSSxFQUFFLENBQUMsVUFBVSxDQUFDLFFBQVEsRUFBRSxVQUFVLENBQUMsU0FBUyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7U0FDbEYsQ0FBQyxDQUFBO0lBQ0wsQ0FBQztJQUVNLEtBQUs7UUFDVCxJQUFJLElBQUksQ0FBQyxTQUFTLENBQUMsT0FBTyxFQUFFO1lBQ3pCLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFBO1NBQzdCO2FBQ0k7WUFDRixJQUFJLENBQUMsUUFBUSxFQUFFLENBQUM7U0FDbEI7SUFDSixDQUFDO0lBRU8sUUFBUTtRQUNiLElBQUksQ0FBQyxXQUFXLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUMsU0FBUyxDQUNuRCxRQUFRLENBQUMsRUFBRTtZQUNSLElBQUksUUFBUSxFQUFFO2dCQUNYLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLENBQUM7Z0JBQzdDLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO2FBQzdCO2lCQUNJO2dCQUNGLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFBO2FBQzdCO1FBQ0osQ0FBQyxFQUNELEtBQUssQ0FBQyxFQUFFO1lBQ0wsT0FBTyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQTtZQUNsQixJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQTtRQUM5QixDQUFDLENBQ0gsQ0FBQTtJQUNKLENBQUM7SUFFTSxPQUFPO1FBQ1gsTUFBTSxDQUFDLFFBQVEsQ0FBQyxJQUFJLEdBQUMsR0FBRyxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUM7SUFDOUMsQ0FBQztJQUVELGdCQUFnQjtJQUNULGdCQUFnQjtRQUNwQixJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUM5QixDQUFDOzttSEFuRVMscUJBQXFCLGtCQVlwQixhQUFhO3VHQVpkLHFCQUFxQixtSUNYbEMsdTNGQStETTs0RkRwRE8scUJBQXFCO2tCQUxqQyxTQUFTO21CQUFDO29CQUNSLFFBQVEsRUFBRSw0QkFBNEI7b0JBQ3RDLFdBQVcsRUFBRSxnQ0FBZ0M7b0JBQzdDLFNBQVMsRUFBRSxDQUFDLGdDQUFnQyxDQUFDO2lCQUMvQzs7MEJBYU0sTUFBTTsyQkFBQyxhQUFhOzZJQVhkLFVBQVU7c0JBQW5CLE1BQU07Z0JBQ0csVUFBVTtzQkFBbkIsTUFBTSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgRXZlbnRFbWl0dGVyLCBJbmplY3QsIE9uSW5pdCwgT3V0cHV0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IEZvcm1CdWlsZGVyLCBGb3JtQ29udHJvbCwgRm9ybUdyb3VwLCBWYWxpZGF0b3JzIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xyXG5cclxuaW1wb3J0IHsgQXV0aGVudGljYXRpb25TZXJ2aWNlIH0gZnJvbSAnLi9zZXJ2aWNlcy9hdXRoLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBUb2tlblBvcnZpZGVyU2VydmljZSB9IGZyb20gJy4vaW50ZXJmYWNlcy90b2tlbi1wYXlsb2FkLXByb3ZpZGVyLmludGVyZmFjZSc7XHJcbmltcG9ydCB7IENPTkZJR0xJQlJBUlksIElDb25maWdMaWJyYXJ5IH0gZnJvbSAnLi4vLi4vY29uZmlnLWxpYnJhcnkuaW50ZXJmYWNlJztcclxuQENvbXBvbmVudCh7XHJcbiAgIHNlbGVjdG9yOiAnbGliLXNlY3VyaXR5LWxpYnJhcnktbG9naW4nLFxyXG4gICB0ZW1wbGF0ZVVybDogJy4vbG9naW4tbGlicmFyeS5jb21wb25lbnQuaHRtbCcsXHJcbiAgIHN0eWxlVXJsczogWycuL2xvZ2luLWxpYnJhcnkuY29tcG9uZW50LnNjc3MnXVxyXG59KVxyXG5leHBvcnQgY2xhc3MgTG9naW5MaWJyYXJ5Q29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcclxuICAgQE91dHB1dCgpIGxvZ2luQ2xpY2sgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgIEBPdXRwdXQoKSByZXNldENsaWNrID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG5cclxuICAgcHVibGljIGxvZ2luRm9ybSE6IEZvcm1Hcm91cDtcclxuICAgcHVibGljIGlzQXV0aGVudGljYXRlZCA9IGZhbHNlO1xyXG4gICBwdWJsaWMgdHlwZUxvZ2luOiBzdHJpbmcgPSAnJztcclxuICAgaXNBZDogYm9vbGVhbiA9IGZhbHNlO1xyXG4gICB0b2tlbkFkOiBzdHJpbmcgPSAnJztcclxuICAgcmVkaXJlY3RVcmk6IHN0cmluZyA9ICcnO1xyXG5cclxuICAgY29uc3RydWN0b3IoXHJcbiAgICAgIEBJbmplY3QoQ09ORklHTElCUkFSWSkgY29uZmlnTGlicmFyeTogSUNvbmZpZ0xpYnJhcnksXHJcbiAgICAgIHByaXZhdGUgZmI6IEZvcm1CdWlsZGVyLFxyXG4gICAgICBwcml2YXRlIGF1dGhTZXJ2aWNlOiBBdXRoZW50aWNhdGlvblNlcnZpY2UsXHJcbiAgICAgIHByaXZhdGUgdG9rZW5Qb3J2aWRlclNlcnZpY2U6IFRva2VuUG9ydmlkZXJTZXJ2aWNlXHJcbiAgICkge1xyXG4gICAgICB0aGlzLnR5cGVMb2dpbiA9IGNvbmZpZ0xpYnJhcnkubG9naW5UeXBlO1xyXG4gICAgICB0aGlzLnJlZGlyZWN0VXJpID0gY29uZmlnTGlicmFyeS5yZWRpcmVjdFVyaTtcclxuICAgIH1cclxuXHJcbiAgIHB1YmxpYyBuZ09uSW5pdCgpOiB2b2lkIHtcclxuICAgICAgdGhpcy5sb2FkRm9ybSgpO1xyXG4gICAgICB0aGlzLnR5cGVMb2dpbiA9IHRoaXMuYXV0aFNlcnZpY2UubG9naW5UeXBlO1xyXG4gICB9XHJcblxyXG4gICBwcml2YXRlIGxvYWRGb3JtKCkge1xyXG4gICAgICB0aGlzLmxvZ2luRm9ybSA9IHRoaXMuZmIuZ3JvdXAoe1xyXG4gICAgICAgICB1c2VyTmFtZTogbmV3IEZvcm1Db250cm9sKG51bGwsIFtWYWxpZGF0b3JzLnJlcXVpcmVkLCBWYWxpZGF0b3JzLm1heExlbmd0aCg1MCldKSxcclxuICAgICAgICAgcGFzc3dvcmQ6IG5ldyBGb3JtQ29udHJvbChudWxsLCBbVmFsaWRhdG9ycy5yZXF1aXJlZCwgVmFsaWRhdG9ycy5tYXhMZW5ndGgoNTApXSksXHJcbiAgICAgIH0pXHJcbiAgIH1cclxuXHJcbiAgIHB1YmxpYyBsb2dpbigpIHtcclxuICAgICAgaWYgKHRoaXMubG9naW5Gb3JtLmludmFsaWQpIHtcclxuICAgICAgICAgdGhpcy5sb2dpbkNsaWNrLmVtaXQoZmFsc2UpXHJcbiAgICAgIH1cclxuICAgICAgZWxzZSB7XHJcbiAgICAgICAgIHRoaXMuYXV0aFVzZXIoKTtcclxuICAgICAgfVxyXG4gICB9XHJcblxyXG4gICBwcml2YXRlIGF1dGhVc2VyKCkge1xyXG4gICAgICB0aGlzLmF1dGhTZXJ2aWNlLmxvZ2luKHRoaXMubG9naW5Gb3JtLnZhbHVlKS5zdWJzY3JpYmUoXHJcbiAgICAgICAgIHJlc3BvbnNlID0+IHtcclxuICAgICAgICAgICAgaWYgKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgIHRoaXMudG9rZW5Qb3J2aWRlclNlcnZpY2Uuc2V0VG9rZW4ocmVzcG9uc2UpO1xyXG4gICAgICAgICAgICAgICB0aGlzLmxvZ2luQ2xpY2suZW1pdCh0cnVlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgdGhpcy5sb2dpbkNsaWNrLmVtaXQoZmFsc2UpXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgfSxcclxuICAgICAgICAgZXJyb3IgPT4ge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcilcclxuICAgICAgICAgICAgdGhpcy5sb2dpbkNsaWNrLmVtaXQoZmFsc2UpXHJcbiAgICAgICAgIH1cclxuICAgICAgKVxyXG4gICB9XHJcblxyXG4gICBwdWJsaWMgbG9naW5BRCgpIHtcclxuICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWY9YCR7dGhpcy5yZWRpcmVjdFVyaX1gO1xyXG4gICB9XHJcblxyXG4gICAvL1Jlc2V0IFBhc3N3b3JkXHJcbiAgIHB1YmxpYyByZWNvdmVyeVBhc3NFbWl0KCl7XHJcbiAgICAgIHRoaXMucmVzZXRDbGljay5lbWl0KHRydWUpO1xyXG4gICB9XHJcblxyXG59XHJcbiIsIjxkaXYgY2xhc3M9XCJjb250YWluZXJcIj5cclxuICA8ZGl2IGNsYXNzPVwicm93IGZvcm0tY29udGVudCBqdXN0aWZ5LWNvbnRlbnQtc3RhcnQgYWxpZ24taXRlbXMtY2VudGVyXCI+XHJcbiAgICA8Zm9ybSBbZm9ybUdyb3VwXT1cImxvZ2luRm9ybVwiID5cclxuICAgICAgPGRpdiBjbGFzcz1cImNvbCBjb2wteGwtNCBjb2wtbGctOCBjb2wtbWQtOCBjb2wtMTJcIj5cclxuICAgICAgICA8ZGl2IGNsYXNzPVwiY29udGFpbmVyLWZsdWlkXCI+XHJcbiAgICAgICAgICA8ZGl2ICpuZ0lmPVwidHlwZUxvZ2luICE9PSAnaW50ZXJuYWwnXCIgY2xhc3M9XCJyb3dcIj5cclxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cImNvbCBjb2wtMTJcIj5cclxuICAgICAgICAgICAgICA8bWF0LWxhYmVsPkNvcnJlb1xyXG4gICAgICAgICAgICAgIDwvbWF0LWxhYmVsPlxyXG4gICAgICAgICAgICAgIDxtYXQtZm9ybS1maWVsZCBbc3R5bGUuZm9udFNpemUucHhdPVwiMTJcIiBhcHBlYXJhbmNlPVwib3V0bGluZVwiPlxyXG4gICAgICAgICAgICAgICAgPG1hdC1sYWJlbD5lamVtcGxvQGNvcnJyZW8uY29tXHJcbiAgICAgICAgICAgICAgICA8L21hdC1sYWJlbD5cclxuICAgICAgICAgICAgICAgIDxtYXQtaWNvbiBtYXRTdWZmaXg+ZW1haWw8L21hdC1pY29uPlxyXG4gICAgICAgICAgICAgICAgPGlucHV0IFxyXG4gICAgICAgICAgICAgICAgICBtYXRJbnB1dCBcclxuICAgICAgICAgICAgICAgICAgdHlwZT1cInRleHRcIiBcclxuICAgICAgICAgICAgICAgICAgcGxhY2Vob2xkZXI9XCJlamVtcGxvQGNvcnJyZW8uY29tXCIgXHJcbiAgICAgICAgICAgICAgICAgIG1heGxlbmd0aD1cIjUwXCIgXHJcbiAgICAgICAgICAgICAgICAgIGZvcm1Db250cm9sTmFtZT1cInVzZXJOYW1lXCIgXHJcbiAgICAgICAgICAgICAgICAgIG5hbWU9XCJ1c2VyTmFtZVwiIFxyXG4gICAgICAgICAgICAgICAgICBpZD1cInVzZXJOYW1lXCIgXHJcbiAgICAgICAgICAgICAgICAgIHJlcXVpcmVkPlxyXG4gICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIDxtYXQtZXJyb3IgKm5nSWY9XCJsb2dpbkZvcm0uZ2V0KCd1c2VyTmFtZScpPy5oYXNFcnJvcigncmVxdWlyZWQnKSAmJiBsb2dpbkZvcm0uZ2V0KCd1c2VyTmFtZScpPy50b3VjaGVkXCI+XHJcbiAgICAgICAgICAgICAgICAgIENhbXBvIHJlcXVlcmlkb1xyXG4gICAgICAgICAgICAgICAgPC9tYXQtZXJyb3I+XHJcbiAgICAgICAgICAgICAgPC9tYXQtZm9ybS1maWVsZD5cclxuICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJjb2wgY29sLTEyXCI+XHJcbiAgICAgICAgICAgICAgPG1hdC1sYWJlbD5Db250cmFzZcOxYTwvbWF0LWxhYmVsPlxyXG4gICAgICAgICAgICAgIDxtYXQtZm9ybS1maWVsZCBbc3R5bGUuZm9udFNpemUucHhdPVwiMTJcIiBhcHBlYXJhbmNlPVwib3V0bGluZVwiPlxyXG4gICAgICAgICAgICAgICAgPG1hdC1sYWJlbD5jb250cmFzZcOxYTwvbWF0LWxhYmVsPlxyXG4gICAgICAgICAgICAgICAgPG1hdC1pY29uIG1hdFN1ZmZpeD52cG5fa2V5PC9tYXQtaWNvbj5cclxuICAgICAgICAgICAgICAgIDxpbnB1dCBcclxuICAgICAgICAgICAgICAgICAgbWF0SW5wdXQgXHJcbiAgICAgICAgICAgICAgICAgIHR5cGU9XCJwYXNzd29yZFwiIFxyXG4gICAgICAgICAgICAgICAgICBwbGFjZWhvbGRlcj1cIkNvbnRyYXNlw7FhXCIgXHJcbiAgICAgICAgICAgICAgICAgIG1heGxlbmd0aD1cIjUwXCIgXHJcbiAgICAgICAgICAgICAgICAgIGZvcm1Db250cm9sTmFtZT1cInBhc3N3b3JkXCIgXHJcbiAgICAgICAgICAgICAgICAgIG5hbWU9XCJwYXNzd29yZFwiIFxyXG4gICAgICAgICAgICAgICAgICBpZD1cInBhc3N3b3JcIiBcclxuICAgICAgICAgICAgICAgICAgcmVxdWlyZWQ+XHJcbiAgICAgICAgICAgICAgICA8bWF0LWVycm9yICpuZ0lmPVwibG9naW5Gb3JtLmdldCgncGFzc3dvcmQnKT8uaGFzRXJyb3IoJ3JlcXVpcmVkJykgJiYgbG9naW5Gb3JtLmdldCgncGFzc3dvcmQnKT8udG91Y2hlZFwiPlxyXG4gICAgICAgICAgICAgICAgICBDYW1wbyByZXF1ZXJpZG9cclxuICAgICAgICAgICAgICAgIDwvbWF0LWVycm9yPlxyXG4gICAgICAgICAgICAgIDwvbWF0LWZvcm0tZmllbGQ+XHJcbiAgICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwicm93IHJlY292ZXJ5LXBhc3NcIj5cclxuICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiY29sIGNvbC0xMlwiPlxyXG4gICAgICAgICAgICAgICAgPGJ1dHRvbiBtYXQtYnV0dG9uIGNsYXNzPVwiYnRuX3RlcnRpYXJ5XCIgKGNsaWNrKT1cInJlY292ZXJ5UGFzc0VtaXQoKVwiPk9sdmlkZSBtaSBjb250cmFzZcOxYTwvYnV0dG9uPlxyXG4gICAgICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cImNvbCBjb2wtMTIgdGV4dC1jZW50ZXJcIj5cclxuICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPVwiYnRuX3ByaW1hcnlcIiAoY2xpY2spPVwibG9naW4oKVwiPkluaWNpYXIgc2VzacOzbjwvYnV0dG9uPlxyXG4gICAgICAgICAgICA8L2Rpdj4gXHJcbiAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICAgIDxkaXYgKm5nSWY9XCJ0eXBlTG9naW4gIT09ICdleHRlcm5hbCdcIiBjbGFzcz1cImNvbCBjb2wtMTIgdGV4dC1jZW50ZXJcIj5cclxuICAgICAgICAgICAgPGJ1dHRvbiBtYXQtYnV0dG9uIGNsYXNzPVwiYnRuX3RlcnRpYXJ5XCIgKGNsaWNrKT1cImxvZ2luQUQoKVwiPkluZ3Jlc2FyIGNvbiBBY3RpdmUgRGlyZWN0b3J5PC9idXR0b24+XHJcbiAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICA8L2Rpdj5cclxuICAgICAgPC9kaXY+XHJcbiAgICA8L2Zvcm0+ICAgXHJcbiAgPC9kaXY+XHJcbjwvZGl2PiJdfQ==